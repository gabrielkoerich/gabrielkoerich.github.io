{% extends "base.html" %}

{% block content %}
{% set data = load_data(path="data/repos.json") %}
{% set descriptions = load_data(path="data/repo-descriptions.json") %}

<h2>Languages</h2>
<div class="lang-bar">
    {% for lang in data.languages %}
    <span class="lang-bar-segment" style="background: {{ lang.color }}; width: {{ lang.percentage }}%" title="{{ lang.name }} {{ lang.percentage }}%"></span>
    {% endfor %}
</div>
<div class="lang-legend">
    {% for lang in data.languages %}
    <span class="lang-legend-item"><span class="lang-dot" style="background: {{ lang.color }}"></span><strong>{{ lang.name }}</strong> {{ lang.percentage }}%</span>
    {% endfor %}
</div>

<p class="repo-count">{{ data.repos | length }} repositories</p>

{% set current_year = "" %}
{% for repo in data.repos %}
    {% set repo_summary = descriptions.summaries | get(key=repo.name, default="") %}
    {% set repo_year = repo.created_at | truncate(length=4, end="") %}
    {% if repo_year != current_year %}
        {% if current_year != "" %}</ul>{% endif %}
        {% set_global current_year = repo_year %}
        <h2>{{ repo_year }}</h2>
        <ul id="repos">
    {% endif %}
    <li class="repo-item">
        <h3>
            <a class="repo-name" href="{{ repo.html_url }}" target="_blank" rel="noopener">{{ repo.name }}</a>
            {% if repo.stargazers_count > 0 %}
                <span class="repo-stars">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    {{ repo.stargazers_count }}
                </span>
            {% endif %}
            <span class="repo-icons">
                {% if repo.pages_url %}
                    <a class="repo-link" href="{{ repo.pages_url }}" target="_blank" rel="noopener" title="View site">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                    </a>
                {% endif %}
                {% if repo.private %}
                    <a class="repo-link" href="{{ repo.html_url }}" target="_blank" rel="noopener" title="Private repo">
                        <svg class="lock-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                    </a>
                {% else %}
                    <a class="repo-link" href="{{ repo.html_url }}" target="_blank" rel="noopener" title="View on GitHub">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                    </a>
                {% endif %}
            </span>
        </h3>
        {% if repo_summary %}
            <p class="repo-summary collapsed">{{ repo_summary }} <button class="show-more" onclick="this.parentElement.classList.toggle('collapsed');this.textContent=this.textContent==='show more'?'show less':'show more'">show more</button></p>
        {% elif repo.description %}
            <p class="repo-summary collapsed">{{ repo.description }} <button class="show-more" onclick="this.parentElement.classList.toggle('collapsed');this.textContent=this.textContent==='show more'?'show less':'show more'">show more</button></p>
        {% endif %}
        <div class="repo-meta">
            <div class="repo-languages">
                {% for lang in repo.languages %}
                    <span class="repo-lang"><span class="lang-dot" style="background: {{ lang.color }}"></span>{{ lang.name }}</span>
                {% endfor %}
            </div>
            <span class="repo-updated">{{ repo.updated_at | truncate(length=10, end="") }}</span>
        </div>
    </li>
{% endfor %}
{% if current_year != "" %}</ul>{% endif %}
{% endblock %}
